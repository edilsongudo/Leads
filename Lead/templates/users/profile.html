{% extends "users/base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}
    <title>Profile</title>
    <link rel="stylesheet" href="{% static 'leadfy/Croppie-2.6.4/croppie.css' %}" />
{% endblock %}

{% block body %}
    <div class="modal">
        <div class="democontainer">
            <div class="demo"></div>
        </div>
        <button id="cropbutton">Crop</button>
    </div>
{% endblock %}

{% block content %}
    <div class="center">
        <div class="subcontent">
            <div class="image-border">
                <div class="round" id="round" style="background-image: url({{ user.profile.image.url }});"></div>
                <button class="clearbtnstyle"><i class="fas fa-pencil-alt"></i></button>
            </div>
        </div>
    </div>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ p_form|crispy }}
        {{ u_form|crispy }}
        <button class="cta cta1" type="submit">Update</button>
        <a href="{% url 'settings' %}" class="cta cta1">Return</a>
    </form>
{% endblock %}

{% block js %}
    <script src="{% static 'leadfy/js/jquery.js' %}"></script>
    <script src="{% static 'leadfy/Croppie-2.6.4/croppie.js' %}"></script>

    <script type="text/javascript">
        var basic = $('.demo').croppie({
            viewport: {
                width: 200,
                height: 200,
                type: 'circle'
            },

        });
    </script>

    <script type="text/javascript">
        btn = document.querySelector('.clearbtnstyle')
        image_input = document.querySelector('#id_image')
        preview_image = document.querySelector('#round')

        btn.addEventListener('click', function () {
            image_input.click()
        })

        image_input.addEventListener('change', function() {

            const file = this.files[0]

            if (file) {
                const reader = new FileReader();
                reader.onload = function () {
                    const result = reader.result

                    basic.croppie('bind', {
                        url: result,
                    });
                    // preview_image.style.backgroundImage = `url(${reader.result})`
                }

            reader.readAsDataURL(file)
            document.querySelector('.modal').style.display = 'flex'

            document.querySelector('#cropbutton').addEventListener('click', function() {

                basic.croppie('result', {type: 'canvas', size: 'viewport'}).then(function(response) {
                    preview_image.style.backgroundImage = `url(${response})`
                    document.querySelector('.modal').style.display = 'none'
                });

            })

            }
        })
    </script>
{% endblock %}
