{% extends 'leadfy/link-base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
    Choose Template
{% endblock %}
{% block meta %}
    <meta name="robots" content="noindex">
    <style type="text/css">
        .formcontent {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        label {
            display: flex;
            flex-wrap: wrap;
            text-align: center;
        }

        label img, #create_custom_template {
            height: 200px;
            width: 150px;
            border-radius: 8px;
            border: 1px solid white;
        }

        input[type="radio"] {
            position: fixed;
            opacity: 0;
            pointer-events: none;
        }

        input[type="radio"]:checked+label img {
            border-color: lightgreen;
        }

        #create_custom_template {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            background: rgba(255, 255, 255, 0.5);
            font-size: 5rem;
            text-align: center;
            text-decoration: none;
        }

        .customtemplatecontainer {
            text-align: center;
        }

    </style>
{% endblock %}

{% block content %}
    <div class="content">
        <h1>Template</h1>
        <p>Choose a template or create a custom one</p>

        <form>
            <div class="formcontent">
                <div class="customtemplatecontainer">
                    <label for="create_custom_template"><div>Custom</div></label>
                    <a id="create_custom_template" href="{% url 'preferences' %}"><i class="fas fa-paint-brush"></i></a>
                </div>
                {% for t in templates %}
                    <input type="radio" name="template" id="{{ t.id }}" value="{{ t.id }}"
                    {% if request.user.preferences.template == t.id|stringformat:"i" %}checked{% endif %}>
                    <label for="{{ t.id }}"><div>{{ t.name }}</div><img src="{{ t.thumbnail.url }}"></label>
                {% endfor %}
            </div>
        </form>
    </div>

    <!-- Nav -->
    <div class="footer flex">
        <div class="sidebar-link footer-active">
            <a href="{% url 'landing_as_author_pv' user.username %}"><img src="{% static 'leadfy/img/blackhome.png' %}"></a>
        </div>
        <div class="sidebar-link footer-active">
            <a href="{% url 'dashboard' 0 %}"><img src="{% static 'leadfy/img/blackchart.png' %}"></a>
        </div>
        <div class="sidebar-link">
            <a href="{% url 'preferences' %}"><img src="{% static 'leadfy/img/bluebrush.png' %}"></a>
        </div>
        <div class="sidebar-link">
            <a href="{% url 'settings' %}"><img src="{% static 'leadfy/img/blackgear.png' %}"></a>
        </div>
    </div>

    <script type="text/javascript" src="{% static 'leadfy/js/getcsrf.js' %}"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        let form = document.querySelector('form')
        const csrfToken = getCookie('csrftoken');
        console.log(csrfToken)

        form.addEventListener('change', function (e) {
            let choosen = e.target.value
            let dict = {'template': choosen}
            submitdata('', dict)
        })

        function submitdata(url, dict) {

            var data = JSON.stringify(dict)

            $.ajax({
                url: url,
                headers: {'X-CSRFToken': csrfToken},
                dataType: 'json',
                data: data,
                type: 'post',
                success: function(response){
                    console.log('Success')
                },
                error: function(error){
                    console.log('Error')
                },
            })
        }
    </script>
{% endblock %}



